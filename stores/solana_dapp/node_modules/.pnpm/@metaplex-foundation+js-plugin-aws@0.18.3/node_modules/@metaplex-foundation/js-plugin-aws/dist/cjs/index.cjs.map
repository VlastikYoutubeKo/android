{"version":3,"file":"index.cjs","sources":["../../src/AwsStorageDriver.ts","../../src/plugin.ts"],"sourcesContent":["import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';\nimport {\n  MetaplexFile,\n  StorageDriver,\n  lamports,\n  Amount,\n} from '@metaplex-foundation/js';\n\nexport class AwsStorageDriver implements StorageDriver {\n  protected client: S3Client;\n  protected bucketName: string;\n\n  constructor(client: S3Client, bucketName: string) {\n    this.client = client;\n    this.bucketName = bucketName;\n  }\n\n  async getUploadPrice(): Promise<Amount> {\n    return lamports(0);\n  }\n\n  async upload(file: MetaplexFile): Promise<string> {\n    const command = new PutObjectCommand({\n      Bucket: this.bucketName,\n      Key: file.uniqueName,\n      Body: file.buffer,\n      ContentType: file.contentType || undefined,\n    });\n\n    try {\n      await this.client.send(command);\n\n      return await this.getUrl(file.uniqueName);\n    } catch (err) {\n      // TODO: Custom errors.\n      throw err;\n    }\n  }\n\n  async getUrl(key: string) {\n    const region = await this.client.config.region();\n    const encodedKey = encodeURIComponent(key);\n\n    return `https://s3.${region}.amazonaws.com/${this.bucketName}/${encodedKey}`;\n  }\n}\n","import type { S3Client } from '@aws-sdk/client-s3';\nimport type { Metaplex, MetaplexPlugin } from '@metaplex-foundation/js';\nimport { AwsStorageDriver } from './AwsStorageDriver';\n\nexport const awsStorage = (\n  client: S3Client,\n  bucketName: string\n): MetaplexPlugin => ({\n  install(metaplex: Metaplex) {\n    metaplex.storage().setDriver(new AwsStorageDriver(client, bucketName));\n  },\n});\n"],"names":["AwsStorageDriver","constructor","client","bucketName","getUploadPrice","lamports","upload","file","command","PutObjectCommand","Bucket","Key","uniqueName","Body","buffer","ContentType","contentType","undefined","send","getUrl","err","key","region","config","encodedKey","encodeURIComponent","awsStorage","install","metaplex","storage","setDriver"],"mappings":";;;;;;;AAQO,MAAMA,gBAAgB,CAA0B;AAIrDC,EAAAA,WAAW,CAACC,MAAgB,EAAEC,UAAkB,EAAE;IAChD,IAAI,CAACD,MAAM,GAAGA,MAAM,CAAA;IACpB,IAAI,CAACC,UAAU,GAAGA,UAAU,CAAA;AAC9B,GAAA;AAEA,EAAA,MAAMC,cAAc,GAAoB;IACtC,OAAOC,WAAQ,CAAC,CAAC,CAAC,CAAA;AACpB,GAAA;EAEA,MAAMC,MAAM,CAACC,IAAkB,EAAmB;AAChD,IAAA,MAAMC,OAAO,GAAG,IAAIC,yBAAgB,CAAC;MACnCC,MAAM,EAAE,IAAI,CAACP,UAAU;MACvBQ,GAAG,EAAEJ,IAAI,CAACK,UAAU;MACpBC,IAAI,EAAEN,IAAI,CAACO,MAAM;AACjBC,MAAAA,WAAW,EAAER,IAAI,CAACS,WAAW,IAAIC,SAAAA;AACnC,KAAC,CAAC,CAAA;IAEF,IAAI;AACF,MAAA,MAAM,IAAI,CAACf,MAAM,CAACgB,IAAI,CAACV,OAAO,CAAC,CAAA;MAE/B,OAAO,MAAM,IAAI,CAACW,MAAM,CAACZ,IAAI,CAACK,UAAU,CAAC,CAAA;KAC1C,CAAC,OAAOQ,GAAG,EAAE;AACZ;AACA,MAAA,MAAMA,GAAG,CAAA;AACX,KAAA;AACF,GAAA;EAEA,MAAMD,MAAM,CAACE,GAAW,EAAE;IACxB,MAAMC,MAAM,GAAG,MAAM,IAAI,CAACpB,MAAM,CAACqB,MAAM,CAACD,MAAM,EAAE,CAAA;AAChD,IAAA,MAAME,UAAU,GAAGC,kBAAkB,CAACJ,GAAG,CAAC,CAAA;IAE1C,OAAQ,CAAA,WAAA,EAAaC,MAAO,CAAiB,eAAA,EAAA,IAAI,CAACnB,UAAW,CAAA,CAAA,EAAGqB,UAAW,CAAC,CAAA,CAAA;AAC9E,GAAA;AACF;;MCzCaE,UAAU,GAAG,CACxBxB,MAAgB,EAChBC,UAAkB,MACE;EACpBwB,OAAO,CAACC,QAAkB,EAAE;AAC1BA,IAAAA,QAAQ,CAACC,OAAO,EAAE,CAACC,SAAS,CAAC,IAAI9B,gBAAgB,CAACE,MAAM,EAAEC,UAAU,CAAC,CAAC,CAAA;AACxE,GAAA;AACF,CAAC;;;;;"}